<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Binary System Analysis &mdash; TAT-pulsar 0.4.3 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "tags": "ams", "useLabelIds": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script src="../_static/custom.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TAT-pulsar package API" href="../autodocs.html" />
    <link rel="prev" title="Pulsar Timing Analysis" href="PulsarTimingAnalysis.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> TAT-pulsar
            <img src="../_static/TATlogo3.pdf" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html"> Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="PulsarTimingAnalysis.html"> Crab Analysis</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#"> Binary System Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Download-Data">Download Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Barycentric-Correction">Barycentric Correction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Frequency-Search-without-Binary-correction">Frequency Search without Binary correction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Binary-Correction">Binary Correction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Deeter-correction">Deeter correction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Solving-Kepler-equation">Solving Kepler equation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Determining-Binary-Ephemeris">Determining Binary Ephemeris</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Simulate-Binary-modulation">Simulate Binary modulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Least-Square-Fitting">Least Square Fitting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Bayesian-Approach-(emcee)">Bayesian Approach (emcee)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Bayesian-Approach-(Nested-sampling)">Bayesian Approach (Nested sampling)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../autodocs.html"> TAT-pulsar API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TAT-pulsar</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../tutorials.html">TAT-pulsar Tutorial</a> &raquo;</li>
      <li>Binary System Analysis</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 0;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pylab</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">wget</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">([</span><span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;nature&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">20170615</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Using matplotlib backend: &lt;object object at 0x7fe6cd4bc0a0&gt;
Populating the interactive namespace from numpy and matplotlib
</pre></div></div>
</div>
<div class="section" id="Binary-System-Analysis">
<h1>Binary System Analysis<a class="headerlink" href="#Binary-System-Analysis" title="Permalink to this headline"></a></h1>
<div class="section" id="Download-Data">
<h2>Download Data<a class="headerlink" href="#Download-Data" title="Permalink to this headline"></a></h2>
<p>First, we use wget to download the data, taking the observation data for Cen X-3 from IXPE as an example. This data has several advantages: - The data size is manageable. - It’s real and publicly available.</p>
<p>The orbital parameter provided by the GBM epoch-folding monitor (<a class="reference external" href="https://gammaray.nsstc.nasa.gov/gbm/science/pulsars/lightcurves/cenx3.html">https://gammaray.nsstc.nasa.gov/gbm/science/pulsars/lightcurves/cenx3.html</a>)</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 49%" />
<col style="width: 51%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>RA</p></td>
<td><p>170.3133 deg</p></td>
</tr>
<tr class="row-even"><td><p>Decl</p></td>
<td><p>-60.6233 deg</p></td>
</tr>
<tr class="row-odd"><td><p>Orbital Period</p></td>
<td><p>2.0869953 days</p></td>
</tr>
<tr class="row-even"><td><p>Period Deriv.</p></td>
<td><p>-1.0150E-08 days/day</p></td>
</tr>
<tr class="row-odd"><td><p>T half pi</p></td>
<td><p>2455073.68504 (JED)</p></td>
</tr>
<tr class="row-even"><td><p>axsin(i)</p></td>
<td><p>39.653 light-sec</p></td>
</tr>
<tr class="row-odd"><td><p>Long. of periastron</p></td>
<td><p>0.00 deg</p></td>
</tr>
<tr class="row-even"><td><p>Eccentricity</p></td>
<td><p>0.0000</p></td>
</tr>
</tbody>
</table>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the Example Data of IXPE on Cen X-3</span>
<span class="o">!</span>wget -q -nH --no-check-certificate --cut-dirs<span class="o">=</span><span class="m">5</span> -r -l0 -c -N -np -R <span class="s1">&#39;index*&#39;</span> -erobots<span class="o">=</span>off --retr-symlinks <span class="err">\</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">heasarc</span><span class="o">.</span><span class="n">gsfc</span><span class="o">.</span><span class="n">nasa</span><span class="o">.</span><span class="n">gov</span><span class="o">/</span><span class="n">FTP</span><span class="o">/</span><span class="n">ixpe</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">obs</span><span class="o">/</span><span class="mi">01</span><span class="o">//</span><span class="mi">01006501</span><span class="o">/</span><span class="n">event_l2</span><span class="o">/</span>
<span class="o">!</span>wget -nH --no-check-certificate --cut-dirs<span class="o">=</span><span class="m">5</span> -r -l0 -c -N -np -R <span class="s1">&#39;index*&#39;</span> -erobots<span class="o">=</span>off --retr-symlinks <span class="err">\</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">heasarc</span><span class="o">.</span><span class="n">gsfc</span><span class="o">.</span><span class="n">nasa</span><span class="o">.</span><span class="n">gov</span><span class="o">/</span><span class="n">FTP</span><span class="o">/</span><span class="n">ixpe</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">obs</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">01006501</span><span class="o">/</span><span class="n">hk</span><span class="o">/</span><span class="n">ixpe01006501_all_orb_v07</span><span class="o">.</span><span class="n">fits</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--2023-06-20 11:45:07--  https://heasarc.gsfc.nasa.gov/FTP/ixpe/data/obs/01/01006501/hk/ixpe01006501_all_orb_v07.fits.gz
Resolving heasarc.gsfc.nasa.gov (heasarc.gsfc.nasa.gov)... 129.164.179.23
Connecting to heasarc.gsfc.nasa.gov (heasarc.gsfc.nasa.gov)|129.164.179.23|:443... connected.
HTTP request sent, awaiting response... 304 Not Modified
File ‘01006501/hk/ixpe01006501_all_orb_v07.fits.gz’ not modified on server. Omitting download.

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ls <span class="m">01006501</span>/*
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
01006501/event_l2:
ixpe01006501_det1_evt2_v15.fits.gz ixpe01006501_det3_evt2_v15.fits.gz
ixpe01006501_det2_evt2_v15.fits.gz

01006501/hk:
ixpe01006501_all_orb_v07.fits.gz
</pre></div></div>
</div>
</div>
<div class="section" id="Barycentric-Correction">
<h2>Barycentric Correction<a class="headerlink" href="#Barycentric-Correction" title="Permalink to this headline"></a></h2>
<p>Next, we use the <code class="docutils literal notranslate"><span class="pre">barycor</span></code> function from the <code class="docutils literal notranslate"><span class="pre">tatpulsar</span></code> package to apply a barycentric correction based on the solar system’s center of mass. Please note that for IXPE data, HEAsoft has a dedicated correction program (<code class="docutils literal notranslate"><span class="pre">barycorr</span></code>). Here, we are demonstrate that <code class="docutils literal notranslate"><span class="pre">tatpulsar</span></code> package also includes a valid barycentric correction function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## READ Data</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;./01006501/event_l2/ixpe01006501_det*.fits.gz&quot;</span><span class="p">)</span>
<span class="n">orbit</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;./01006501/hk/ixpe01006501_all_orb_v07.fits.gz&quot;</span><span class="p">)</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

<span class="k">for</span> <span class="n">evt</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
    <span class="n">hdulist</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">hdulist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;TIME&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
./01006501/event_l2/ixpe01006501_det1_evt2_v15.fits.gz
./01006501/event_l2/ixpe01006501_det2_evt2_v15.fits.gz
./01006501/event_l2/ixpe01006501_det3_evt2_v15.fits.gz
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tatpulsar.utils.functions</span> <span class="kn">import</span> <span class="n">met2mjd</span><span class="p">,</span> <span class="n">mjd2met</span>
<span class="kn">from</span> <span class="nn">tatpulsar.pulse.barycor.barycor</span> <span class="kn">import</span> <span class="n">barycor</span>

<span class="n">ra</span><span class="o">=</span><span class="mf">170.313301</span>
<span class="n">dec</span><span class="o">=-</span><span class="mf">60.6233</span>

<span class="n">tdb_mjd</span> <span class="o">=</span> <span class="n">barycor</span><span class="p">(</span><span class="n">met2mjd</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">telescope</span><span class="o">=</span><span class="s1">&#39;ixpe&#39;</span><span class="p">),</span>
                  <span class="n">ra</span><span class="o">=</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span>
                  <span class="n">orbit</span><span class="o">=</span><span class="n">orbit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                  <span class="n">accelerate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tdb_met</span> <span class="o">=</span> <span class="n">mjd2met</span><span class="p">(</span><span class="n">tdb_mjd</span><span class="p">,</span> <span class="s1">&#39;ixpe&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accelerating barycor
</pre></div></div>
</div>
</div>
<div class="section" id="Frequency-Search-without-Binary-correction">
<h2>Frequency Search without Binary correction<a class="headerlink" href="#Frequency-Search-without-Binary-correction" title="Permalink to this headline"></a></h2>
<p>Next, we perform a period search for the pulsar using the <code class="docutils literal notranslate"><span class="pre">epoch_folding_search</span></code> function in <code class="docutils literal notranslate"><span class="pre">stingray</span></code>.</p>
<p>What we demonstrate here is that the period found before applying the binary orbit correction is not the intrinsic period of the neutron star. The actual period differs from the modulated period found, due to the binary orbit modulation.</p>
<p>However, once we apply the binary orbit correction to the photons, the period found is indeed the intrinsic period of the neutron star.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stingray.pulse.search</span> <span class="kn">import</span> <span class="n">epoch_folding_search</span>
<span class="n">period</span> <span class="o">=</span> <span class="mf">4.79660</span>
<span class="n">nbin</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">df_min</span> <span class="o">=</span> <span class="mf">1e-4</span>
<span class="n">df</span> <span class="o">=</span> <span class="mf">1e-5</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">period</span> <span class="o">-</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">period</span> <span class="o">+</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

<span class="n">freq</span><span class="p">,</span> <span class="n">efstat</span> <span class="o">=</span> <span class="n">epoch_folding_search</span><span class="p">(</span><span class="n">tdb_met</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="n">nbin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">efstat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">nbin</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;n-1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">period</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">efstat</span><span class="p">)],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Freq (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;EF stat&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7fe6b5c66ed0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BinaryAnalysis_10_1.png" src="../_images/notebooks_BinaryAnalysis_10_1.png" />
</div>
</div>
</div>
<div class="section" id="Binary-Correction">
<h2>Binary Correction<a class="headerlink" href="#Binary-Correction" title="Permalink to this headline"></a></h2>
<p>Next, we apply a binary orbit correction using two methods. One is the correction under extreme gravitational fields as described in Deeter’s paper, and the other is by solving Kepler’s equation to calculate the intrinsic emission time of the photons in the binary system.</p>
<div class="section" id="Deeter-correction">
<h3>Deeter correction<a class="headerlink" href="#Deeter-correction" title="Permalink to this headline"></a></h3>
<p>Correct the photon arrival times to the photon emission time Deeter model.</p>
<p>Reference: <code class="docutils literal notranslate"><span class="pre">Deeter</span> <span class="pre">et</span> <span class="pre">al.</span> <span class="pre">1981,</span> <span class="pre">ApJ,</span> <span class="pre">247:1003-1012</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tatpulsar.pulse.binary</span> <span class="kn">import</span> <span class="n">orbit_cor_deeter</span>

<span class="c1">#-----------------------------------</span>
<span class="n">Porb</span> <span class="o">=</span> <span class="mf">2.0869953</span> <span class="c1">#day</span>
<span class="n">axsini</span> <span class="o">=</span> <span class="mf">39.653</span> <span class="c1">#light-sec</span>
<span class="n">e</span> <span class="o">=</span> <span class="mf">0.0000</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mf">0.00</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
<span class="n">T_pi2</span> <span class="o">=</span> <span class="mf">2455073.68504</span> <span class="o">-</span> <span class="mf">2400000.5</span> <span class="c1">#mjd</span>
<span class="n">x_mid</span> <span class="o">=</span> <span class="mi">298</span>
<span class="n">y_mid</span> <span class="o">=</span> <span class="mi">306</span>

<span class="n">Tnod</span> <span class="o">=</span> <span class="n">T_pi2</span> <span class="o">+</span> <span class="n">Porb</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mjd</span>
<span class="n">tnod</span> <span class="o">=</span> <span class="n">mjd2met</span><span class="p">(</span><span class="n">Tnod</span><span class="p">,</span> <span class="n">telescope</span><span class="o">=</span><span class="s1">&#39;ixpe&#39;</span><span class="p">)</span> <span class="c1">#met</span>

<span class="n">tdb_bicor</span> <span class="o">=</span> <span class="n">orbit_cor_deeter</span><span class="p">(</span><span class="n">tdb_met</span><span class="p">,</span> <span class="n">Porb</span><span class="o">*</span><span class="mi">86400</span><span class="p">,</span> <span class="n">axsini</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">tnod</span><span class="p">)</span>

<span class="c1">## EF search</span>
<span class="n">period</span> <span class="o">=</span> <span class="mf">4.79660</span>
<span class="n">nbin</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">df_min</span> <span class="o">=</span> <span class="mf">1e-4</span>
<span class="n">df</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">period</span><span class="o">-</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">period</span> <span class="o">+</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="n">freq</span><span class="p">,</span> <span class="n">efstat</span> <span class="o">=</span> <span class="n">epoch_folding_search</span><span class="p">(</span><span class="n">tdb_bicor</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="n">nbin</span><span class="p">)</span>

<span class="c1"># Plotting</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">efstat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">nbin</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;n-1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">period</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">efstat</span><span class="p">)],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Freq (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;EF stat&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7fe6b73d4fd0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BinaryAnalysis_13_1.png" src="../_images/notebooks_BinaryAnalysis_13_1.png" />
</div>
</div>
</div>
<div class="section" id="Solving-Kepler-equation">
<h3>Solving Kepler equation<a class="headerlink" href="#Solving-Kepler-equation" title="Permalink to this headline"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tatpulsar.pulse.binary</span> <span class="kn">import</span> <span class="n">orbit_cor_kepler</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">orbit_cor_kepler</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on function orbit_cor_kepler in module tatpulsar.pulse.binary:

orbit_cor_kepler(time, Tw, ecc, Porb, omega, axsini, PdotOrb=0, omegadot=0, gamma=0)
    Corrects observed times of photons to their emission times
    based on the Kepler function for a binary system.

    Parameters
    ----------
    time: float
        The time of observed photon in MJD
    Tw: float
        The periastron time in MJD
    ecc: float
        Eccentricity
    Porb: float
        Orbital period in second
    PdotOrb: float (optional)
        Second derivative of Orbital period in sec/sec default is 0
    omega: float
        Long. of periastron in radians.
    omegadot: float (optional)
        second derivative of Long. of periastron in rad/sec
    axsini: float
        projection of semi major axis in light-sec
    gamma: float
        0

    Returns
    -------
    t_em: float
        The emitting time of photon in binary system in MJD

    Example
    -------
    &gt;&gt;&gt; observed_time = np.array([...]) # Time series in MJD
    &gt;&gt;&gt; Tw = 54424.71               #Barycentric time (in MJD(TDB)) of periastron
    &gt;&gt;&gt; e = 0.68                    #orbital eccentricity
    &gt;&gt;&gt; Porb = 249.48 * 86400.      #Orbital period (s)
    &gt;&gt;&gt; omega = -26. *np.pi/180.    #Longitude of periastron (radians)
    &gt;&gt;&gt; axsin = 530.                 #Projected semi-major axis (light seconds)
    &gt;&gt;&gt; Porb_dot = 0                #First derivative of Orbital period
    &gt;&gt;&gt; binary_corrected_time = orbit_cor_kepler(observed_time
                                                Tw=Tw,
                                                ecc=e,
                                                Porb=Porb,
                                                Porb_dot,
                                                omega,
                                                0,
                                                asin,
                                                0)

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#-----------------------------------</span>
<span class="n">Porb</span> <span class="o">=</span> <span class="mf">2.0869953</span> <span class="c1">#day</span>
<span class="n">axsini</span> <span class="o">=</span> <span class="mf">39.653</span> <span class="c1">#light-sec</span>
<span class="n">e</span> <span class="o">=</span> <span class="mf">0.0000</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mf">0.00</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
<span class="n">T_pi2</span> <span class="o">=</span> <span class="mf">2455073.68504</span> <span class="o">-</span> <span class="mf">2400000.5</span> <span class="c1">#mjd</span>

<span class="n">T_periastron</span> <span class="o">=</span> <span class="n">T_pi2</span> <span class="o">+</span> <span class="n">Porb</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># mjd</span>
<span class="n">t_periastron</span> <span class="o">=</span> <span class="n">mjd2met</span><span class="p">(</span><span class="n">Tnod</span><span class="p">,</span> <span class="n">telescope</span><span class="o">=</span><span class="s1">&#39;ixpe&#39;</span><span class="p">)</span> <span class="c1">#met</span>

<span class="n">tdb_bicor_kepler</span> <span class="o">=</span> <span class="n">orbit_cor_kepler</span><span class="p">(</span><span class="n">met2mjd</span><span class="p">(</span><span class="n">tdb_met</span><span class="p">,</span> <span class="s1">&#39;ixpe&#39;</span><span class="p">),</span>
                                    <span class="n">Tw</span><span class="o">=</span><span class="n">T_periastron</span><span class="p">,</span>
                                    <span class="n">ecc</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
                                    <span class="n">Porb</span><span class="o">=</span><span class="n">Porb</span><span class="o">*</span><span class="mi">86400</span><span class="p">,</span>
                                    <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span>
                                    <span class="n">axsini</span><span class="o">=</span><span class="n">axsini</span><span class="p">)</span>
<span class="n">tdb_bicor_kepler</span> <span class="o">=</span> <span class="n">mjd2met</span><span class="p">(</span><span class="n">tdb_bicor_kepler</span><span class="p">,</span> <span class="s1">&#39;ixpe&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## EF search</span>
<span class="n">period</span> <span class="o">=</span> <span class="mf">4.79660</span>
<span class="n">nbin</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">df_min</span> <span class="o">=</span> <span class="mf">1e-4</span>
<span class="n">df</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">period</span><span class="o">-</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">period</span> <span class="o">+</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="n">freq</span><span class="p">,</span> <span class="n">efstat</span> <span class="o">=</span> <span class="n">epoch_folding_search</span><span class="p">(</span><span class="n">tdb_bicor_kepler</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="n">nbin</span><span class="p">)</span>

<span class="c1"># Plotting</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">efstat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">nbin</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;n-1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">period</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">efstat</span><span class="p">)],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Freq (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;EF stat&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7fe6b6eb00d0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BinaryAnalysis_18_1.png" src="../_images/notebooks_BinaryAnalysis_18_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Determining-Binary-Ephemeris">
<h2>Determining Binary Ephemeris<a class="headerlink" href="#Determining-Binary-Ephemeris" title="Permalink to this headline"></a></h2>
<p>For those binary systems with no known binary ephemeris, several strategies can be employed to uncover the binary characteristics of the system. In this section, we’ll explore these methods using data from the X-ray binary 4U 1901+03 as an illustrative example on how to derive the binary solution.</p>
<div class="section" id="Simulate-Binary-modulation">
<h3>Simulate Binary modulation<a class="headerlink" href="#Simulate-Binary-modulation" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Simulate the intrinsic frequency evolution of NS</span>
<span class="n">mjd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">58000</span><span class="p">,</span> <span class="mi">59000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">f0_fake</span> <span class="o">=</span> <span class="mf">0.362</span>
<span class="n">f1_fake</span> <span class="o">=</span> <span class="mf">2.5e-11</span>
<span class="n">f2_fake</span> <span class="o">=</span> <span class="mf">1.5e-18</span>
<span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">mjd</span><span class="o">-</span><span class="n">mjd</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">*</span><span class="mi">86400</span>
<span class="n">freq_true</span> <span class="o">=</span> <span class="n">f0_fake</span> <span class="o">+</span> <span class="n">f1_fake</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">f2_fake</span><span class="o">*</span><span class="n">dt</span><span class="o">**</span><span class="mi">2</span>
<span class="n">freq_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">freq_true</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-6</span> <span class="c1"># Hz/s</span>

<span class="c1">## Gaussian sampling from the Frequencies data set</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">freq_true</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">freq_err</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">freq_true</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;The Intrinsic Period of NS&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">mjd</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">freq_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (MJD)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BinaryAnalysis_21_0.png" src="../_images/notebooks_BinaryAnalysis_21_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">intrinsic_freq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">):</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="mi">86400</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">+</span> <span class="n">f1</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">f2</span><span class="o">*</span><span class="p">(</span><span class="n">dt</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#+ (1/6)*f3*(dt**3) + (1/24)*f4*(dt**4)</span>
    <span class="k">return</span> <span class="n">f</span>

<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="n">popt_infrq</span><span class="p">,</span> <span class="n">pcov_infrq</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">intrinsic_freq</span><span class="p">,</span>
                                   <span class="n">mjd</span><span class="p">,</span>
                                   <span class="n">freq</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>
<span class="k">def</span> <span class="nf">plot_dataresi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span>
                  <span class="n">model</span><span class="p">,</span>
                  <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (MJD)&quot;</span><span class="p">,</span>
                  <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Freqency (Hz)&quot;</span><span class="p">,</span>
                  <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">legend</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">model</span><span class="p">)</span><span class="o">/</span><span class="n">freq_err</span><span class="p">,</span>
                 <span class="n">yerr</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (MJD)&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plot_dataresi</span><span class="p">(</span><span class="n">mjd</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">freq_err</span><span class="p">,</span>
              <span class="n">intrinsic_freq</span><span class="p">(</span><span class="n">mjd</span><span class="p">,</span> <span class="o">*</span><span class="n">popt_infrq</span><span class="p">),</span>
              <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (MJD)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Freqency (Hz)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BinaryAnalysis_22_0.png" src="../_images/notebooks_BinaryAnalysis_22_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tatpulsar.pulse.binary</span> <span class="kn">import</span> <span class="n">freq_doppler</span>

<span class="n">fake_axsini</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">fake_Porb</span>   <span class="o">=</span> <span class="mi">100</span> <span class="c1">#days</span>
<span class="n">fake_omega</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">fake_e</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">fake_T_halfpi</span> <span class="o">=</span> <span class="mi">58540</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The fake orbital parameters modulated on the intrinsic frequencies are:</span><span class="se">\n\n</span><span class="s2"> axsini=</span><span class="si">{</span><span class="n">fake_axsini</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Porb=</span><span class="si">{</span><span class="n">fake_Porb</span><span class="si">}</span><span class="s2"> days</span><span class="se">\n</span><span class="s2"> omega=</span><span class="si">{</span><span class="n">fake_omega</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
      <span class="sa">f</span><span class="s2">&quot; e=</span><span class="si">{</span><span class="n">fake_e</span><span class="si">}</span><span class="se">\n</span><span class="s2"> T_halfpi=</span><span class="si">{</span><span class="n">fake_T_halfpi</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>\
      <span class="sa">f</span><span class="s2">&quot; F0=</span><span class="si">{</span><span class="n">f0_fake</span><span class="si">}</span><span class="s2">, F1=</span><span class="si">{</span><span class="n">f1_fake</span><span class="si">}</span><span class="s2">, F2=</span><span class="si">{</span><span class="n">f2_fake</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">f_dopp</span> <span class="o">=</span> <span class="n">freq_doppler</span><span class="p">(</span><span class="n">mjd2met</span><span class="p">(</span><span class="n">mjd</span><span class="p">,</span> <span class="s1">&#39;fermi&#39;</span><span class="p">),</span>
                      <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">axsini</span><span class="o">=</span><span class="n">fake_axsini</span><span class="p">,</span>
                      <span class="n">Porb</span><span class="o">=</span><span class="n">fake_Porb</span><span class="o">*</span><span class="mi">86400</span><span class="p">,</span>
                      <span class="n">omega</span><span class="o">=</span><span class="n">fake_omega</span><span class="p">,</span>
                      <span class="n">e</span><span class="o">=</span><span class="n">fake_e</span><span class="p">,</span>
                      <span class="n">T_halfpi</span><span class="o">=</span><span class="n">fake_T_halfpi</span><span class="p">)</span>

<span class="n">freq_obs</span> <span class="o">=</span> <span class="n">f_dopp</span> <span class="o">+</span> <span class="n">freq</span>

<span class="n">plot_dataresi</span><span class="p">(</span><span class="n">mjd</span><span class="p">,</span> <span class="n">freq_obs</span><span class="p">,</span> <span class="n">freq_err</span><span class="p">,</span>
              <span class="n">freq</span><span class="p">,</span>
              <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (MJD)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Freqency (Hz)&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;NS intrinsic Frequency&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The fake orbital parameters modulated on the intrinsic frequencies are:

 axsini=2000
 Porb=100 days
 omega=4.71238898038469
 e=0.05
 T_halfpi=58540
 F0=0.362, F1=2.5e-11, F2=1.5e-18
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BinaryAnalysis_23_1.png" src="../_images/notebooks_BinaryAnalysis_23_1.png" />
</div>
</div>
</div>
<div class="section" id="Least-Square-Fitting">
<h3>Least Square Fitting<a class="headerlink" href="#Least-Square-Fitting" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">wrapper_fun</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>
                <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span>
                <span class="n">axsini</span><span class="p">,</span> <span class="n">Porb</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">+</span> <span class="n">f1</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">f2</span><span class="o">*</span><span class="n">dt</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">freq_doppler</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axsini</span><span class="p">,</span> <span class="n">Porb</span><span class="o">*</span><span class="mi">86400</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">fake_T_halfpi</span><span class="p">)</span> <span class="o">+</span> <span class="n">freq</span>

<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">wrapper_fun</span><span class="p">,</span> <span class="n">mjd2met</span><span class="p">(</span><span class="n">mjd</span><span class="p">,</span> <span class="s1">&#39;fermi&#39;</span><span class="p">),</span> <span class="n">freq_obs</span><span class="p">,</span>
                       <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="n">f0_fake</span><span class="p">,</span> <span class="n">f1_fake</span><span class="p">,</span> <span class="n">f2_fake</span><span class="p">,</span>
                           <span class="n">fake_axsini</span><span class="p">,</span> <span class="n">fake_Porb</span><span class="p">,</span> <span class="n">fake_omega</span><span class="p">,</span> <span class="n">fake_e</span><span class="p">])</span>


<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">mjd</span><span class="p">,</span> <span class="n">wrapper_fun</span><span class="p">(</span><span class="n">mjd2met</span><span class="p">(</span><span class="n">mjd</span><span class="p">,</span> <span class="s1">&#39;fermi&#39;</span><span class="p">),</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span> <span class="o">-</span> <span class="n">freq_obs</span><span class="p">,</span>
             <span class="n">yerr</span><span class="o">=</span><span class="n">freq_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\chi$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (MJD&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BinaryAnalysis_25_0.png" src="../_images/notebooks_BinaryAnalysis_25_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">report_result</span><span class="p">(</span><span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span><span class="p">):</span>
    <span class="n">perr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">))</span>
    <span class="n">par_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;F0&#39;</span><span class="p">,</span> <span class="s1">&#39;F1&#39;</span><span class="p">,</span> <span class="s1">&#39;F2&#39;</span><span class="p">,</span> <span class="s1">&#39;axsini&#39;</span><span class="p">,</span> <span class="s1">&#39;Porb&#39;</span><span class="p">,</span> <span class="s1">&#39;Omega&#39;</span><span class="p">,</span> <span class="s1">&#39;Eccentricity&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">popt</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">par_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2"> +- </span><span class="si">{</span><span class="n">perr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">report_result</span><span class="p">(</span><span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
F0: 0.3619999406313884 +- 3.3209695685669207e-07
F1: 2.4992247763193333e-11 +- 1.775394439010689e-14
F2: 1.5003531933140412e-18 +- 3.9764514319685076e-22
axsini: 2000.395060610975 +- 0.6074379363926161
Porb: 99.99995771438674 +- 7.31267183081882e-05
Omega: 4.709537609067158 +- 0.006136431597904715
Eccentricity: 0.04981853019176014 +- 0.00030180024800663245
</pre></div></div>
</div>
</div>
<div class="section" id="Bayesian-Approach-(emcee)">
<h3>Bayesian Approach (emcee)<a class="headerlink" href="#Bayesian-Approach-(emcee)" title="Permalink to this headline"></a></h3>
<p>The logrithmic Likelihood function is:</p>
<p>$:nbsphinx-math:<cite>ln</cite><span class="math">\mathcal{L}`(:nbsphinx-math:</span>theta <cite>| :nbsphinx-math:</cite>mathcal{D}`) = -<span class="math">\frac{1}{2}</span> <span class="math">\sum `:nbsphinx-math:</span>frac{(f_{rm{obs}} - f_{rm{model}})^2}{sigma^2}` $</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;F0&#39;</span><span class="p">,</span> <span class="s1">&#39;F1&#39;</span><span class="p">,</span> <span class="s1">&#39;F2&#39;</span><span class="p">,</span> <span class="s1">&#39;axsini&#39;</span><span class="p">,</span> <span class="s1">&#39;P_orb&#39;</span><span class="p">,</span> <span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]</span>

 <span class="c1"># Expect values:  axsini=2000</span>
 <span class="c1"># Porb=100 days</span>
 <span class="c1"># omega=4.71238898038469</span>
 <span class="c1"># e=0.45</span>
 <span class="c1"># T_halfpi=58540</span>
 <span class="c1"># F0=0.362, F1=2.5e-11, F2=1.5e-18</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">mjd2met</span><span class="p">(</span><span class="n">mjd</span><span class="p">,</span> <span class="s1">&#39;fermi&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">freq_obs</span>
<span class="n">err</span> <span class="o">=</span> <span class="n">freq_err</span>


<span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">,</span><span class="n">yerr</span><span class="p">):</span>
    <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">axsini</span><span class="p">,</span> <span class="n">P_orb</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">params</span>

    <span class="n">P_orb</span> <span class="o">=</span> <span class="n">P_orb</span> <span class="o">*</span> <span class="mi">86400</span>

    <span class="n">T_halfpi</span> <span class="o">=</span> <span class="n">mjd2met</span><span class="p">(</span><span class="mi">58540</span><span class="p">,</span> <span class="s1">&#39;fermi&#39;</span><span class="p">)</span>

    <span class="n">t0</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">t0</span>

    <span class="n">f_spin</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">+</span> <span class="n">f1</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">f2</span><span class="o">*</span><span class="n">dt</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">f_dopp</span> <span class="o">=</span> <span class="n">freq_doppler</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">axsini</span><span class="p">,</span> <span class="n">P_orb</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">fake_T_halfpi</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">f_spin</span> <span class="o">+</span> <span class="n">f_dopp</span>

    <span class="n">loglike</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">y</span> <span class="o">-</span> <span class="n">model</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">yerr</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">loglike</span>

<span class="k">def</span> <span class="nf">log_prior</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">axsini</span><span class="p">,</span> <span class="n">P_orb</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">params</span>
    <span class="k">if</span> <span class="mf">0.2</span> <span class="o">&lt;</span> <span class="n">f0</span> <span class="o">&lt;</span> <span class="mf">0.563</span> <span class="ow">and</span> <span class="mf">1e-13</span> <span class="o">&lt;</span> <span class="n">f1</span> <span class="o">&lt;</span> <span class="mf">6e-11</span> <span class="ow">and</span> <span class="mf">1e-20</span> <span class="o">&lt;</span> <span class="n">f2</span> <span class="o">&lt;</span> <span class="mf">6e-18</span> <span class="ow">and</span> <span class="mi">1000</span> <span class="o">&lt;</span> <span class="n">axsini</span> <span class="o">&lt;</span> <span class="mi">3000</span> <span class="ow">and</span> <span class="mi">50</span> <span class="o">&lt;</span> <span class="n">P_orb</span> <span class="o">&lt;</span> <span class="mi">150</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">&lt;</span> <span class="n">omega</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

<span class="k">def</span> <span class="nf">log_probability</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">):</span>
    <span class="n">lp</span> <span class="o">=</span> <span class="n">log_prior</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lp</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="n">lp</span> <span class="o">+</span> <span class="n">log_likelihood</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="n">nll</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="o">-</span><span class="n">log_likelihood</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="n">initial</span> <span class="o">=</span> <span class="p">[</span><span class="n">f0_fake</span><span class="p">,</span> <span class="n">f1_fake</span><span class="p">,</span> <span class="n">f2_fake</span><span class="p">,</span> <span class="n">fake_axsini</span><span class="p">,</span> <span class="n">fake_Porb</span><span class="p">,</span> <span class="n">fake_omega</span><span class="p">,</span> <span class="n">fake_e</span><span class="p">]</span>
<span class="n">soln</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">nll</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">err</span><span class="p">),</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">)</span>
<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">npars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">x</span><span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nwalkers</span><span class="p">,</span> <span class="n">npars</span><span class="p">))</span>

<span class="n">pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-14</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">)</span>
<span class="n">pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-14</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">)</span>
<span class="n">pos</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-18</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">)</span>
<span class="n">pos</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">)</span>
<span class="n">pos</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-14</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">)</span>
<span class="n">pos</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-14</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">)</span>
<span class="n">pos</span><span class="p">[:,</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:,</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-14</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">)</span>

<span class="c1"># pos = soln.x + 1e-15 * np.random.randn(nwalkers, 7)</span>
<span class="c1"># print(pos[:,1])</span>
<span class="n">nwalkers</span><span class="p">,</span> <span class="n">ndim</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">emcee</span>

<span class="n">sampler</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span>
    <span class="n">nwalkers</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">log_probability</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|█████████████████████████████████████████████████████████████████████| 5000/5000 [00:11&lt;00:00, 417.70it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samples</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">],</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;step number&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BinaryAnalysis_32_0.png" src="../_images/notebooks_BinaryAnalysis_32_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">corner</span>

<span class="n">flat_samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span>
    <span class="n">flat_samples</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">truths</span><span class="o">=</span><span class="p">[</span><span class="n">f0_fake</span><span class="p">,</span> <span class="n">f1_fake</span><span class="p">,</span> <span class="n">f2_fake</span><span class="p">,</span> <span class="n">fake_axsini</span><span class="p">,</span> <span class="n">fake_Porb</span><span class="p">,</span> <span class="n">fake_omega</span><span class="p">,</span> <span class="n">fake_e</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
    <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">],</span> <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BinaryAnalysis_33_0.png" src="../_images/notebooks_BinaryAnalysis_33_0.png" />
</div>
</div>
</div>
<div class="section" id="Bayesian-Approach-(Nested-sampling)">
<h3>Bayesian Approach (Nested sampling)<a class="headerlink" href="#Bayesian-Approach-(Nested-sampling)" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_likelihood_ns</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">axsini</span><span class="p">,</span> <span class="n">P_orb</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">P_orb</span> <span class="o">=</span> <span class="n">P_orb</span> <span class="o">*</span> <span class="mi">86400</span>

    <span class="n">T_halfpi</span> <span class="o">=</span> <span class="n">mjd2met</span><span class="p">(</span><span class="mi">58540</span><span class="p">,</span> <span class="s1">&#39;fermi&#39;</span><span class="p">)</span>

    <span class="n">t0</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

    <span class="n">f_spin</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">+</span> <span class="n">f1</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">f2</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">f_dopp</span> <span class="o">=</span> <span class="n">freq_doppler</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">axsini</span><span class="p">,</span> <span class="n">P_orb</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">fake_T_halfpi</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">f_spin</span> <span class="o">+</span> <span class="n">f_dopp</span>
    <span class="n">loglike</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span> <span class="p">((</span><span class="n">data</span> <span class="o">-</span> <span class="n">model</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">loglike</span>

<span class="k">def</span> <span class="nf">prior_transform</span><span class="p">(</span><span class="n">cube</span><span class="p">):</span>
    <span class="c1"># the argument, cube, consists of values from 0 to 1</span>
    <span class="c1"># we have to convert them to physical scales</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.02</span> <span class="o">+</span> <span class="mf">0.361</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">5.0e-11</span> <span class="o">+</span> <span class="mf">1.0e-11</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">5e-18</span> <span class="o">+</span> <span class="mf">1e-18</span>

    <span class="c1"># axsini</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1999</span>

    <span class="c1"># P_orb</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">99</span>

    <span class="c1">#omega</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="c1"># e</span>
    <span class="n">params</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">params</span>

<span class="kn">from</span> <span class="nn">ultranest</span> <span class="kn">import</span> <span class="n">ReactiveNestedSampler</span>

<span class="n">sampler</span> <span class="o">=</span> <span class="n">ReactiveNestedSampler</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">log_likelihood_ns</span><span class="p">,</span> <span class="n">prior_transform</span><span class="p">,</span>
    <span class="n">wrapped_params</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">min_num_live_points</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">dKL</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">min_ess</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Sampling 200 live points from prior ...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "69b64744b890441ead1f7b549301ac6d", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Explored until L=-6e+01  0 [-59.6800..-59.6798]*| it/evals=11223/136630 eff=8.2262% N=200    0    0   0   0      0
[ultranest] Likelihood function evaluations: 136950
[ultranest]   logZ = -111.1 +- 0.3497
[ultranest] Effective samples strategy satisfied (ESS = 1291.4, need &gt;10)
[ultranest] Posterior uncertainty strategy is satisfied (KL: 0.45+-0.09 nat, need &lt;inf nat)
[ultranest] Evidency uncertainty strategy wants 214 minimum live points (dlogz from 0.28 to 0.94, need &lt;0.5)
[ultranest]   logZ error budget: single: 0.49 bs:0.35 tail:0.01 total:0.35 required:&lt;0.50
[ultranest] Widening roots to 214 live points (have 200 already) ...
[ultranest] Sampling 14 live points from prior ...
Z=-111.1(98.93%) | Like=-59.68..-59.20 [-59.6797..-59.6784]*| it/evals=12003/149834 eff=6.0451% N=214   14   4   14 14   14
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
<span class="ansi-yellow-intense-fg ansi-bold">WARNING </span> (pint.logging                  ): <span class="ansi-yellow-intense-fg ansi-bold">Sampling from region seems inefficient (0/40 accepted in iteration 2500). To improve efficiency, modify the transformation so that the current live points are ellipsoidal, or use a stepsampler, or set frac_remain to a lower number (e.g., 0.5) to terminate earlier.</span>
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ultranest] Explored until L=-6e+01  0 [-59.6673..-59.6638]*| it/evals=12020/161385 eff=3.2554% N=214
[ultranest] Likelihood function evaluations: 161385
[ultranest]   logZ = -111.1 +- 0.3096
[ultranest] Effective samples strategy satisfied (ESS = 1392.4, need &gt;10)
[ultranest] Posterior uncertainty strategy is satisfied (KL: 0.46+-0.11 nat, need &lt;inf nat)
[ultranest] Evidency uncertainty strategy wants 212 minimum live points (dlogz from 0.23 to 0.72, need &lt;0.5)
[ultranest]   logZ error budget: single: 0.48 bs:0.31 tail:0.01 total:0.31 required:&lt;0.50
[ultranest] done iterating.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">corner</span>
<span class="k">def</span> <span class="nf">cornerplot</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make a corner plot with corner.&quot;&quot;&quot;</span>
    <span class="n">paramnames</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;paramnames&#39;</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;weighted_samples&#39;</span><span class="p">][</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;weighted_samples&#39;</span><span class="p">][</span><span class="s1">&#39;weights&#39;</span><span class="p">])</span>
    <span class="n">cumsumweights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">cumsumweights</span> <span class="o">&gt;</span> <span class="mf">1e-4</span>

    <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">warn</span> <span class="o">=</span> <span class="s1">&#39;Posterior is still concentrated in a single point:&#39;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">paramnames</span><span class="p">):</span>

                <span class="n">v</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">][</span><span class="n">mask</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">warn</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s1">&#39;    </span><span class="si">%-20s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warn</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Try running longer.&#39;</span><span class="p">)</span>
        <span class="c1"># return</span>

    <span class="c1"># monkey patch to disable a useless warning</span>
    <span class="n">oldfunc</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">warning</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s1">&#39;truths&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">truths</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;truths&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">truths</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">,:],</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
                  <span class="n">labels</span><span class="o">=</span><span class="n">paramnames</span><span class="p">,</span> <span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">title_fmt</span><span class="o">=</span><span class="s1">&#39;.4f&#39;</span><span class="p">,</span> <span class="n">title_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">},</span>
                  <span class="n">label_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">},</span>
                  <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">],</span>
                  <span class="n">truths</span><span class="o">=</span><span class="n">truths</span><span class="p">,</span>
                  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span> <span class="o">=</span> <span class="n">oldfunc</span>
<span class="n">cornerplot</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">truths</span><span class="o">=</span><span class="p">[</span><span class="n">f0_fake</span><span class="p">,</span> <span class="n">f1_fake</span><span class="p">,</span> <span class="n">f2_fake</span><span class="p">,</span> <span class="n">fake_axsini</span><span class="p">,</span> <span class="n">fake_Porb</span><span class="p">,</span> <span class="n">fake_omega</span><span class="p">,</span> <span class="n">fake_e</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_BinaryAnalysis_36_0.png" src="../_images/notebooks_BinaryAnalysis_36_0.png" />
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="PulsarTimingAnalysis.html" class="btn btn-neutral float-left" title="Pulsar Timing Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../autodocs.html" class="btn btn-neutral float-right" title="TAT-pulsar package API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Youli.
      <span class="lastupdated">Last updated on 2023 Jun 23 at 10:45:08 UTC.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>